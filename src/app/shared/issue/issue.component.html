<div class="card p-2 m-3" *ngIf="exists; else not_found">
    <alert></alert>
    <div class="m-2">
        <span class="issue-text">
            Issue #{{ id }}
        </span>
        <span class="badge badge-secondary"> {{ issue.status }} </span>
        <span class="issue-hint mx-1">
            {{ issue.client }} / {{ issue.type }}
        </span>
    </div>

    <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">

        <li [ngbNavItem]="0" [class]="getClass(0)">
            <a ngbNavLink>Details</a>
            <ng-template ngbNavContent>
                <div class="row m-3">
                    <div class="col-md-6">
                        <h5> Issue details </h5>
                        <div class="text-center">
                            <detail name="ID" [value]="issue.id"></detail>
                            <detail name="Status" [value]="issue.status"></detail>
                            <detail name="Type" [value]="issue.type"></detail>
                            <detail name="Customer" [value]="issue.client"></detail>
                            <detail name="Part" [value]="issue.part"></detail>
                            <detail name="Area" [value]="issue.area"></detail>
                            <detail name="Phase" [value]="issue.phase"></detail>
                            <detail name="Problem" [value]="issue.problem"></detail>
                            <detail name="Description" [value]="issue.description"></detail>
                            <detail name="Originator" [value]="issue.originator"></detail>
                            <detail name="Generated" [value]="datePipe.transform(issue.created, 'medium', 'UTC')">
                            </detail>
                            <detail name="Last updated"
                                [value]="datePipe.transform(issue.lastUpdated, 'medium', 'UTC')">
                            </detail>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <h5> 8D's status </h5>
                        <div class="text-center">
                            <div *ngFor="let d of Ds; let i = index">
                                <detail *ngIf="issue[d] != null" [name]="d.toUpperCase()" status="done"
                                    [value]="'Done ' + datePipe.transform(issue[d].done, 'medium', 'UTC')"
                                    class="link-d" [title]="'Go to ' + d.toUpperCase()" (click)="active = i+1">
                                </detail>
                                <detail *ngIf="issue[d] == null" [name]="d.toUpperCase()" status="waiting"
                                    value="Not yet defined">
                                </detail>
                            </div>
                        </div>

                        <br>

                        <div *ngIf="issue.incident">
                            <h5> Customer incident details </h5>
                            <div class="text-center">
                                <detail name="Customer name" [value]="issue.client"></detail>
                                <detail name="Customer CAR" [value]="issue.incident.car"></detail>
                                <detail name="Issued"
                                    [value]="datePipe.transform(issue.incident.issued, 'medium', 'UTC')">
                                </detail>
                                <detail name="Contact name" [value]="issue.incident.contact"></detail>
                                <detail name="Contact email" [value]="issue.incident.email"></detail>
                            </div>
                        </div>
                    </div>

                </div>
            </ng-template>
        </li>

        <li [ngbNavItem]="1" [class]="getClass(1)">
            <a ngbNavLink>D1</a>
            <ng-template ngbNavContent>
                <div class="containter text-center pt-2 mb-5 mx-3">
                    <h5 class="text-left"> D1.- Define the team </h5>
                    <h6 class="text-left">
                        <i class="far fa-clock"></i>
                        Done on
                        <span class="date">
                            {{ issue.d1.done | date:'medium':'UTC' }}
                        </span>
                    </h6>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-sm">
                            <thead>
                                <tr class="header">
                                    <th scope="col" class="align-middle">Member</th>
                                    <th scope="col" class="align-middle">Email</th>
                                    <th scope="col" class="align-middle">Position</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let member of issue.d1.team">
                                    <td> {{ member.name }} </td>
                                    <td> {{ member.email }} </td>
                                    <td> {{ member.position }} </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </ng-template>
        </li>

        <li [ngbNavItem]="2" [class]="getClass(2)">
            <a ngbNavLink>D2</a>
            <ng-template ngbNavContent>
                <div class="containter pt-2 mb-5 mx-3">
                    <h5 class="text-left"> D2.- Describe the problem </h5>
                    <h6 class="text-left">
                        <i class="far fa-clock"></i>
                        Done on
                        <span class="date">
                            {{ issue.d2.done | date:'medium':'UTC' }}
                        </span>
                    </h6>
                    <div class="row m-3">
                        <div class="col-md-6">
                            <h5> Problem analysis </h5>
                            <div class="text-left ml-3">
                                <detail name="What is the problem?" [value]="issue.d2.whatIs" decorator=""></detail>
                                <detail name="Where is it happening?" [value]="issue.d2.whereIs" decorator=""></detail>
                                <detail name="When did it happen?" [value]="issue.d2.whenIs" decorator=""></detail>
                                <detail name="Who is impacted?" [value]="issue.d2.whoIs" decorator=""></detail>
                                <detail name="Why is it a problem?" [value]="issue.d2.whyIs" decorator=""></detail>
                                <detail name="How many/much is it affecting?" [value]="issue.d2.much" decorator="">
                                </detail>
                                <detail name="How often is it happening?" [value]="issue.d2.often" decorator="">
                                </detail>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <h5> Problem definition </h5>
                            <div class="text-left ml-3">
                                <detail name="Custmer PN" [value]="issue.d2.customerPN"></detail>
                                <detail name="Customer part description" [value]="issue.d2.pnDescription"></detail>
                                <detail name="Failure mode" [value]="issue.d2.failureMode"></detail>
                                <detail name="Problem description" [value]="issue.d2.description"></detail>
                                <detail name="Repeated incident?" [value]="issue.d2.repeated" decorator=""></detail>
                                <detail name="Final customer affected?" [value]="issue.d2.finalAffected" decorator="">
                                </detail>
                                <detail *ngIf="issue.d2.finalAffected == 'Yes'" name="Customer affected"
                                    [value]="issue.d2.customerAffected"></detail>
                            </div>
                        </div>

                    </div>
                </div>
            </ng-template>
        </li>

        <li [ngbNavItem]="2" [class]="getClass(3)">
            <a ngbNavLink>D3</a>
            <ng-template ngbNavContent>
            </ng-template>
        </li>

        <li [ngbNavItem]="2" [class]="getClass(4)">
            <a ngbNavLink>D4</a>
            <ng-template ngbNavContent>
            </ng-template>
        </li>

        <li [ngbNavItem]="2" [class]="getClass(5)">
            <a ngbNavLink>D5</a>
            <ng-template ngbNavContent>
            </ng-template>
        </li>

        <li [ngbNavItem]="2" [class]="getClass(6)">
            <a ngbNavLink>D6</a>
            <ng-template ngbNavContent>
            </ng-template>
        </li>

        <li [ngbNavItem]="2" [class]="getClass(7)">
            <a ngbNavLink>D7</a>
            <ng-template ngbNavContent>
            </ng-template>
        </li>

        <li [ngbNavItem]="2" [class]="getClass(8)">
            <a ngbNavLink>D8</a>
            <ng-template ngbNavContent>
            </ng-template>
        </li>

    </ul>

    <div [ngbNavOutlet]="nav" class="mt-2"></div>
</div>
<ng-template #not_found>
    <error-message type="error" title="ERROR" [loading]="exists" [description]="'We could not find issue #' + id">
    </error-message>
</ng-template>